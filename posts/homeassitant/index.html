<!DOCTYPE html>
<html lang='en' ><meta charset="utf-8">
<meta name="viewport" content="width=device-width">


<title>Homeassitant - WTPersonal</title>

<meta name="generator" content="Hugo Eureka 0.8.4" />
<link rel="stylesheet" href="/css/eureka.min.css">
<script defer src="/js/eureka.min.js"></script>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
  href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap"
  as="style" onload="this.onload=null;this.rel='stylesheet'">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/solarized-light.min.css"
   media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js"
   crossorigin></script>

  <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/languages/dart.min.js"
     crossorigin></script>

<script defer src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js"
   integrity="sha256-uNYoXefWRqv&#43;PsIF/OflNmwtKM4lStn9yrz2gVl6ymo="  crossorigin></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
   integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3&#43;Aro6EYUG4&#43;cU&#43;KJWu/X"  media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" 
  integrity="sha384-g7c&#43;Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI&#43;sEnkvrMWph2EDg4"  crossorigin></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
   integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC&#43;Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa"  crossorigin></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
        { left: "\\(", right: "\\)", display: false },
        { left: "\\[", right: "\\]", display: true }
      ],
    });
  });
</script>


<script defer src="https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js" 
  integrity="sha256-Zmpaaj&#43;GXFsPF5WdPArSrnW3b30dovldeKsW00xBVwE="  crossorigin></script>


<link rel="icon" type="image/png" sizes="32x32" href="/images/icon_hu64421c6c7700f606f0ad45d807017b09_5843_32x32_fill_box_center_3.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/icon_hu64421c6c7700f606f0ad45d807017b09_5843_180x180_fill_box_center_3.png">

<meta name="description"
  content="-- with XiaoMi Smart Devices">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1 ,
      "name":"Posts",
      "item":"/posts/"},{
      "@type": "ListItem",
      "position": 2 ,
      "name":"Homeassitant",
      "item":"/posts/homeassitant/"}]
}
</script>



<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/posts/homeassitant/"
    },
    "headline": "Homeassitant - WTPersonal","datePublished": "2021-11-24T16:10:30+08:00",
    "dateModified": "2021-11-30T16:10:30+08:00",
    "wordCount":  495 ,
    "publisher": {
        "@type": "Person",
        "name": "T. Wu",
        "logo": {
            "@type": "ImageObject",
            "url": "/images/icon.png"
        }
        },
    "description": "-- with XiaoMi Smart Devices"
}
</script><meta property="og:title" content="Homeassitant - WTPersonal" />
<meta property="og:type" content="article" />


<meta property="og:image" content="/images/icon.png">


<meta property="og:url" content="/posts/homeassitant/" />



<meta property="og:description" content="-- with XiaoMi Smart Devices" />



<meta property="og:locale" content="en" />




<meta property="og:site_name" content="WTPersonal" />






<meta property="article:published_time" content="2021-11-24T16:10:30&#43;08:00" />


<meta property="article:modified_time" content="2021-11-30T16:10:30&#43;08:00" />



<meta property="article:section" content="posts" />


<meta property="article:tag" content="More" />

<meta property="article:tag" content="Smart Device" />





<body class="flex flex-col min-h-screen">
  <header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm">
    <div class="w-full max-w-screen-xl mx-auto"><script>
    let storageColorScheme = localStorage.getItem("lightDarkMode")
    if (((storageColorScheme == 'Auto' || storageColorScheme == null) && window.matchMedia("(prefers-color-scheme: dark)").matches) || storageColorScheme == "Dark") {
        document.getElementsByTagName('html')[0].classList.add('dark')
    }
</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
    <a href="/" class="mr-6 text-primary-text text-xl font-bold">WTPersonal</a>
    <button id="navbar-btn" class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
        <i class="fas fa-bars"></i>
    </button>

    <div id="target"
        class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="md:flex md:h-16 text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0">
            <a href="/posts/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  selected-menu-item  mr-4">Posts</a>
            <a href="/categories/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">Categories</a>
            <a href="/tags/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">Tags</a>
            <a href="/project/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">Project</a>
            <a href="/archives/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">Archives</a>
            <a href="/about/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">About</a>
        </div>

        <div class="flex">
            <div class="relative pt-4 md:pt-0">
                <div class="cursor-pointer hover:text-eureka" id="lightDarkMode">
                    <i class="fas fa-adjust"></i>
                </div>
                <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
                </div>
                <div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40"
                    id='lightDarkOptions'>
                    <span class="px-4 py-1 hover:text-eureka" name="Light">Light</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Dark">Dark</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Auto">Auto</span>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    
    let element = document.getElementById('lightDarkMode')
    if (storageColorScheme == null || storageColorScheme == 'Auto') {
        document.addEventListener('DOMContentLoaded', () => {
            window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change', switchDarkMode)
        })
    } else if (storageColorScheme == "Light") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'sun')
        element.firstElementChild.classList.add('fa-sun')
    } else if (storageColorScheme == "Dark") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'moon')
        element.firstElementChild.classList.add('fa-moon')
    }

    document.addEventListener('DOMContentLoaded', () => {
        getcolorscheme();
        switchBurger();
    });
</script>
</div>
  </header>
  <main class="flex-grow pt-16">
    <div class="pl-scrollbar">
      <div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto">


<div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12">
    <div
        class="col-span-2  lg:col-span-6 bg-secondary-bg rounded px-6 py-8">
        <h1 class="font-bold text-3xl text-primary-text">Homeassitant</h1>
        <div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text">
    <div class="mr-6 my-2">
        <i class="fas fa-calendar mr-1"></i>
        <span>2021-11-24</span>
    </div>
    <div class="mr-6 my-2">
        <i class="fas fa-clock mr-1"></i>
        <span>3 min read</span>
    </div>
    
    
    <div class="mr-6 my-2">
        <i class="fas fa-folder mr-1"></i>
        
        <a href="/categories/more/" class="hover:text-eureka">More</a>
        
    </div>
    

    
</div>
        
        
        

        <div class="content">
            <h2 id="homeassitant-installation-by-docker">Homeassitant installation by docker</h2>
<p>docker-compose.yml</p>
<pre><code class="language-yml">version: &quot;3&quot;

services:
  homeassitant:
    container_name: homeassistant
    image: homeassistant/home-assistant
    restart: unless-stopped
    network_mode: host
    privileged: true
    # environment:
    # - https_proxy=http://172.16.8.168:8123
    volumes:
      - /root/homeassistant/config:/config
      - /etc/localtime:/etc/localtime:ro
</code></pre>
<p>Create and Run docker</p>
<pre><code class="language-bash">docker-compose up -d
</code></pre>
<h2 id="hacs-installation-integrations-of-the-community-store">HACS installation (Integrations of the community store)</h2>
<p>If hacs not installed, manually install hacs</p>
<pre><code class="language-bash"># Go inside the container
docker exec -it homeassistant bash

# Run the hacs download script
wget -O - https://get.hacs.xyz | bash -

# Exit the container
exit
</code></pre>
<p>Restart homeassistant docker or restart server in Server Controls in Configuration.
If you are in China with very low speed of connecting hacs.xyz website, add http proxy in environment variable of docker compose file. It might to help to fast connect.</p>
<p>More details, following up with <a href="hacs.xyz/docs/configuration/basic">official instruction</a></p>
<h2 id="integrations">Integrations</h2>
<p>Because we have a bad connection to github. I manuel install most of them from github.</p>
<h3 id="themes">Themes</h3>
<p>There is lovelace-ios-dark-mode-theme as an example</p>
<pre><code class="language-bash"># download theme
git clone https://github.com/basnijholt/lovelace-ios-dark-mode-theme.git PATH/TO/HOMESSISTANT/config/themes
</code></pre>
<p>Add two lines to PATH/TO/HOMESSISTANT/config/configuration.yaml</p>
<pre><code class="language-yml">frontend:
  themes: !include_dir_merge_named themes
</code></pre>
<p>Finally, restart homeassistant service and setup theme at theme of user&rsquo;s configuration</p>
<h3 id="homekit">HomeKit</h3>
<ol>
<li>Directly install &lsquo;HomeKit&rsquo; in homeassistant official integration.</li>
<li>Apple devices pairing with QR code or 8 digits in Notification.</li>
<li>Setup configuration in homeassistant integration</li>
</ol>
<h3 id="xiaomi-miot-pending">XiaoMi MIoT (Pending)</h3>
<pre><code class="language-bash">git clone https://github.com/ha0y/xiaomi_miot_raw.git
cp -dr ./xiaomi_miot_raw/custom_components/xiaomi_miot_raw PATH/TO/HOMESSISTANT/config/custom_components
# restart homeassistant docker or restart server in Server Controls in Configuration
docker restart homeassistant
</code></pre>
<p>Finally, set up XiaoMi account at Configuration/Integrations</p>
<h2 id="setup-homeshortcut-in-ios">Setup Home&amp;Shortcut in IOS</h2>
<p>There are several issues I met in IOS setting up:</p>
<ul>
<li>Home app cannot connect to smart devices outside of home networks
<ul>
<li>But do not have a solution yet</li>
</ul>
</li>
<li>Home &amp; Shortcut app cannot setup switch on or off only actions on smart devices</li>
<li>After solving switch on or off only actions, the button light on and off in Home app is not a correct. That light on or off does not perform correctly as smart devices real switch state. Because unidirectional action only need to run it and do not need to &lsquo;off&rsquo; run it</li>
</ul>
<h3 id="switch-on-or-off-only-actions">Switch on or off only actions</h3>
<p>The default home assistant switch button can trigger on and off. But cannot switch on or off only. An example of that, In my computer room I place 2 NFC tags to control computer on or off individually. But I don&rsquo;t want computer turn off by mis-touch when computer is on.</p>
<p>The best way to achieve this function is making a <code>script</code> in home assistant configuration.
Which applies to any other presetting action as well, such as trigger a specific light color value.</p>
<h3 id="homeshortcut-in-ios">Home&amp;Shortcut in IOS</h3>
<p>As all script set done, the Home app may not display the action of scripts. Under homeassistant Integration menu, <code>HomeKit integration must be re-add script element</code>.
At HomeKit integration icon. A configure model shall be popped up after click its configure button. Remove script first, and then re-open configure to add scripts.</p>
<p><code>In shortcut app, the action need to be doubled</code>, because second action can turn icon button light off.</p>

        </div>
        
        <div class="my-4">
    
    <a href="/tags/more/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#More</a>
    
    <a href="/tags/smart-device/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#Smart Device</a>
    
</div>
        
        
        


        
        
        
        
<div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t">
    <div>
        
    </div>
    <div class="md:text-right mt-4 md:mt-0">
        
        <span class="block font-bold">Next</span>
        <a href="/posts/memo/collection/" class="block">Collection</a>
        
    </div>
</div>

        



    </div>
    
    <div class="col-span-2">
        
        
        <div class="sticky top-16 z-10 hidden lg:block px-6 py-4  bg-primary-bg ">
    <span class="text-lg font-semibold">On This Page</span>
</div>
<div class="sticky-toc hidden lg:block px-6 pb-6 ">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#homeassitant-installation-by-docker">Homeassitant installation by docker</a></li>
    <li><a href="#hacs-installation-integrations-of-the-community-store">HACS installation (Integrations of the community store)</a></li>
    <li><a href="#integrations">Integrations</a>
      <ul>
        <li><a href="#themes">Themes</a></li>
        <li><a href="#homekit">HomeKit</a></li>
        <li><a href="#xiaomi-miot-pending">XiaoMi MIoT (Pending)</a></li>
      </ul>
    </li>
    <li><a href="#setup-homeshortcut-in-ios">Setup Home&amp;Shortcut in IOS</a>
      <ul>
        <li><a href="#switch-on-or-off-only-actions">Switch on or off only actions</a></li>
        <li><a href="#homeshortcut-in-ios">Home&amp;Shortcut in IOS</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        enableStickyToc();
    });
</script>
        
    </div>
    

    
    
</div>
<script>
    document.addEventListener('DOMContentLoaded', ()=>{
        hljs.initHighlightingOnLoad();
    })
</script>

      </div>
    </div>
    
  </main>
  <footer class="pl-scrollbar">
    <div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b">
    <p class="text-sm text-tertiary-text">&copy; 2021 <a href="https://www.wtpersonal.xyz/">T. Wu</a> Powered by <a href="https://github.com/wangchucheng/hugo-eureka/">the Eureka</a> theme for <a href="https://gohugo.io/">Hugo</a>
 &middot;  Powered by the <a href="https://github.com/wangchucheng/hugo-eureka" class="hover:text-eureka">Eureka</a> theme for <a href="https://gohugo.io" class="hover:text-eureka">Hugo</a></p>
</div></div>
  </footer>
</body>

</html>